version: "3"
volumes:
  smnrp-data:
services:
 api:
   volumes:
     - /data/revseq/results_example_for_database/package_results:/data
 ws:
    image: ethnexus/smnrp:1.1.1
    volumes:
      - "web_root:/web_root:z"
      - "smnrp-data:/etc/letsencrypt"
      - ./api/static:/vol/web/static:z
      - ./api/media:/vol/web/media:z

    ports:
      - "80:80"
      - "443:443"
    env_file: .env
    restart: unless-stopped
    depends_on:
      - api
      - db
  ui:
    command: >
      bash -c "\
        yarn install
        rm -rf /app/dist/*
        yarn run build
        mv /app/dist/spa/* /app/dist/.
        rm -rf /app/dist/spa
      "
